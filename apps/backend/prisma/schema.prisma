generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// =====================================================
// Bảng admin_users - Quản lý tài khoản admin
// =====================================================
model User {
  id           Int        @id @default(autoincrement())
  username     String     @unique @db.VarChar(100)
  passwordHash String     @map("password_hash") @db.Text
  displayName  String     @map("display_name") @db.VarChar(255)
  role         String     @default("admin") @db.VarChar(50)
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  blogPosts    BlogPost[] @relation("BlogAuthor")

  @@map("admin_users")
}

// =====================================================
// Bảng blog_posts - Quản lý bài viết blog
// =====================================================
model BlogPost {
  id           Int       @id @default(autoincrement())
  code         String    @unique @db.VarChar(100)
  slug         String    @unique @db.VarChar(150)
  title        String    @db.Text
  subtitle     String?   @db.Text
  excerpt      String?   @db.Text
  content      String    @db.LongText
  imageUrl     String?   @map("image_url") @db.Text
  category     String?   @db.VarChar(120)
  tags         String?   @db.Text
  keywords     String?   @db.Text
  authorName   String?   @map("author_name") @db.VarChar(120)
  authorRole   String?   @map("author_role") @db.VarChar(120)
  publishedAt  DateTime  @default(now()) @map("published_at")
  status       String    @default("published") @db.VarChar(40)
  galleryMedia Json?     @map("gallery_media")
  videoItems   Json?     @map("video_items")
  sourceLinks  Json?     @map("source_links")
  isFeatured   Int       @default(0) @map("is_featured") @db.TinyInt
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  // Relation với User (optional - nếu muốn liên kết author)
  authorId     Int?      @map("author_id")
  author       User?     @relation("BlogAuthor", fields: [authorId], references: [id])

  @@index([publishedAt(sort: Desc)], map: "idx_published_at")
  @@index([status], map: "idx_status")
  @@index([category], map: "idx_category")
  @@index([isFeatured], map: "idx_is_featured")
  @@map("blog_posts")
}

// =====================================================
// Bảng products - Quản lý sản phẩm
// =====================================================
model Product {
  id                Int      @id @default(autoincrement())
  code              String   @unique @db.VarChar(100)
  slug              String   @unique @db.VarChar(150)
  name              String   @db.Text
  category          String?  @db.VarChar(120)
  shortDescription  String?  @map("short_description") @db.Text
  description       String?  @db.LongText
  imageUrl          String?  @map("image_url") @db.Text
  featureTags       String?  @map("feature_tags") @db.Text
  highlights        String?  @db.Text
  ctaPrimaryLabel   String?  @map("cta_primary_label") @db.Text
  ctaPrimaryUrl     String?  @map("cta_primary_url") @db.Text
  ctaSecondaryLabel String?  @map("cta_secondary_label") @db.Text
  ctaSecondaryUrl   String?  @map("cta_secondary_url") @db.Text
  galleryMedia      Json?    @map("gallery_media")
  videoItems        Json?    @map("video_items")
  demoMedia         Json?    @map("demo_media")
  status            String   @default("active") @db.VarChar(40)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@index([status], map: "idx_product_status")
  @@index([category], map: "idx_product_category")
  @@map("products")
}

// =====================================================
// Bảng customer_reviews - Đánh giá từ khách hàng
// =====================================================
model CustomerReview {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(255) @map("name")
  role        String   @db.VarChar(255) @map("role")
  company     String?  @db.VarChar(255) @map("company")
  rating      Float    @default(5) @db.Float
  quote       String   @db.Text
  bgColor     String   @default("#3B82F6") @map("bg_color") @db.VarChar(20)
  status      String   @default("published") @db.VarChar(40)
  isFeatured  Int      @default(0) @map("is_featured") @db.TinyInt
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([status], map: "idx_review_status")
  @@index([isFeatured], map: "idx_review_featured")
  @@index([createdAt(sort: Desc)], map: "idx_review_created")
  @@map("customer_reviews")
}

// =====================================================
// Bảng visit_stats - Thống kê lượt truy cập theo IP
// =====================================================
model VisitStat {
  id            Int      @id @default(autoincrement())
  ipAddress     String   @db.VarChar(45) @map("ip_address")
  userAgent     String?  @db.VarChar(255) @map("user_agent")
  visitCount    Int      @default(1) @map("visit_count")
  lastVisitedAt DateTime @map("last_visited_at")
  createdAt     DateTime @default(now()) @map("created_at")

  @@unique([ipAddress], map: "ux_visit_ip")
  @@index([ipAddress], map: "idx_visit_ip")
  @@index([lastVisitedAt(sort: Desc)], map: "idx_visit_last")
  @@map("visit_stats")
}

// =====================================================
// Bảng cookie_consents - Lưu chấp thuận cookie
// =====================================================
model CookieConsent {
  id            Int      @id @default(autoincrement())
  ipAddress     String   @db.VarChar(45) @map("ip_address")
  userAgent     String?  @db.VarChar(255) @map("user_agent")
  consented     Boolean  @default(true) @map("consented")
  preferences   Json?    @map("preferences")
  consentedAt   DateTime @default(now()) @map("consented_at")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([ipAddress], map: "idx_cookie_ip")
  @@index([consentedAt(sort: Desc)], map: "idx_cookie_time")
  @@map("cookie_consents")
}

// =====================================================
// Bảng sessions - Lưu trữ session đăng nhập
// =====================================================
model Session {
  sessionId String @id @map("session_id") @db.VarChar(128)
  expires   Int    @db.UnsignedInt
  data      String? @db.MediumText

  @@index([expires], map: "idx_expires")
  @@map("sessions")
}
